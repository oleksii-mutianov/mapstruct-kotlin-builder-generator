# mapstruct-kotlin-builder-generator

Library for generating builders for data classes, that are used in Mapstruct mappers as return types.

## The problem

In Kotlin the following code produces 2 constructors from perspective of Java,
default one and with parameters:

```kotlin
data class Example(
    val prop1: String? = null,
    val prop2: String? = null
)
```

According to the
[Mapstruct documentation](https://mapstruct.org/documentation/stable/reference/html/#mapping-with-constructors),
Mapstruct always prefers a default constructor. However, since properties are declared as `val`,
they cannot be reassigned.

There is known [mapstruct issue #2378](https://github.com/mapstruct/mapstruct/issues/2378)
and some possible workarounds:

- use the `@Default` annotation to mark non-empty constructor
- mark properties as `var` so that Mapstruct can reassign them
- avoid using default values in constructors
- explicitly define the default constructor as private

However, these solutions can make your code a little messy.
Moreover, sometimes, you cannot apply any of these solutions
because your data classes are generated by third-party tools such as
[dgs-codegen](https://github.com/Netflix/dgs-codegen) or [jooq](https://github.com/jOOQ/jOOQ).

## The solution

According to the [documentation](https://mapstruct.org/documentation/dev/reference/html/#mapping-with-builders),
Mapstruct supports mapping of immutable types via builders, and you can implement your custom builder provider logic.

So, my solution generates builders at compile time for data classes that are used in Mapstruct mappers
as return types.

Partly inspired by https://github.com/Pozo/mapstruct-kotlin.

## The usage

First apply kapt plugin

```groovy
plugins {
    id "org.jetbrains.kotlin.kapt" version "1.6.21"
}
```

Then add these to your project as dependency:

```groovy
kapt("io.github.olxmute:mapstruct-kotlin-builder-generator:0.0.3")
```